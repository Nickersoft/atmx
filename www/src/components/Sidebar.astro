---
import Default from "@astrojs/starlight/components/Sidebar.astro";
import type { Props } from "@astrojs/starlight/props";
import clsx from "clsx";

type Item = Props["sidebar"][number];

const { sidebar, ...props } = Astro.props;

function updateLinks(items: Item[], child: boolean = false) {
  for (const link of items) {
    if (link.type === "link") {
      link.attrs.class = clsx(
        "p-2 hover:!text-foreground-muted tracking-tight text-foreground-muted overflow-hidden rounded-md",
        link.isCurrent && "text-foreground",
        child && link.isCurrent && "!font-normal",
        "active:opacity-50 transition-all duration-150",
      );
    } else {
      link.entries = updateLinks(link.entries, true);
    }
  }
  return items;
}

const updatedSidebar = updateLinks(sidebar);
---

<Default {...props} sidebar={updatedSidebar} />

<style is:global>
  #starlight__sidebar {
    .top-level {
      & > li {
        @apply mt-0;
      }

      li {
        @apply border-0;
      }
    }

    summary {
      @apply !py-2;
    }
  }
</style>
